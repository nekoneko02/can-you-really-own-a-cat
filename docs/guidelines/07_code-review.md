# コードレビューガイド

## 基本方針

各ガイドラインに沿っていることを確認する。

## チェック項目

### プロジェクト固有ルールの遵守

`@docs/guidelines/01_project-context.md` の内容に沿っているか:

- **ログ出力**: `@/lib/log.ts` の構造化ログを使用しているか（`console.log()` 禁止）
- **API呼び出し**: `@/infrastructure/api/ApiClient.ts` のラッパー関数を使用しているか（直接 `fetch()` 禁止）
- **コメント**: 不要なコメント（what）が残っていないか、意味のあるコメント（why）のみか
- **セッション管理**: iron-session で適切に実装されているか

### ドメイン層の設計

`@docs/guidelines/02_domain-layer.md` の内容に沿っているか:

- **エンティティ vs 値オブジェクト**: 適切に区別されているか
- **モジュール公開ルール**: `index.ts` 経由で公開されているか、直 import がないか
- **`@internal` 表記**: 内部専用の要素に `@internal` JSDoc が付いているか
- **ドメインモデル図との同期**: public メソッド・プロパティが図に記載されているか

### ゲームロジックの実装

`@docs/guidelines/03_game-logic.md` の内容に沿っているか:

- **シナリオエンジン**: Compositeパターンで適切に実装されているか
- **Event → EventResult → ParameterChange**: 適切な流れで実装されているか
- **ターン制**: ターン単位で状態管理されているか
- **静的シナリオ**: ランダム性が排除されているか

### UI層の実装

`@docs/guidelines/04_ui-layer.md` の内容に沿っているか:

- **Next.js と Phaser の責務分担**: 適切に分離されているか
- **Phaser のステートレス設計**: Scene が状態を保持していないか
- **ApiClient の使用**: UI層から直接 `fetch()` を使用していないか

### テストの実装

`@docs/guidelines/05_testing.md` の内容に沿っているか:

- **TDD**: テストファーストで実装されているか
- **カバレッジ**: C1カバレッジ（分岐網羅）が確保されているか
- **境界値テスト**: 境界値テストが含まれているか
- **テストファイル配置**: `test/` ディレクトリに配置されているか

### 商用品質

- **不要な要素の削除**: デバッグ用のコメント・ログが残っていないか
- **型安全性**: TypeScript の型定義が適切か、`any` 型の乱用がないか
- **エラーハンドリング**: 適切なエラーハンドリングが実装されているか

## レビュー後の確認

- すべてのビルドチェックをパス
- すべてのテストをパス
- ドメインモデル図が最新化されている
