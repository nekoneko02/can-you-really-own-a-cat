# プロジェクト固有情報

## プロジェクト概要

- プロダクト名：君はねこを飼えるか？
- コンセプト：ねこを飼うか迷っている人に、判断材料を与え、ゲームで疑似体験させる
- アプローチ：責任感ではなく「気づき」を提供し、最終判断はユーザーに委ねる
- タグライン：「飼う前に、猫を知ろう」

## アーキテクチャ全体像

このプロジェクトは、ドメイン駆動設計（DDD）+ 3層構成でアーキテクチャを設計します。

### 3層構成

1. **Next.js**: アプリ全体のフレームワーク（画面遷移・API呼び出し・状態管理）
2. **Phaser**: ゲームエンジン（1ゲーム1Sceneのステートレス実装）
3. **共通モジュール**: 疎結合連携のためのラッパー群（ApiClient, GameManager, StateSaverなど）

### DDD 5つのドメイン

1. **User**: ユーザー認証・プロフィール管理
2. **Cat**: ねこの内部状態・感情・AI行動
3. **Game**: ゲームロジック・シナリオ進行
4. **ContentManagement**: アセット・シナリオデータ管理
5. **DataAnalytics**: プレイログ・気づき分析

## ディレクトリ構成

```
src/
├── domain/          # ドメインモデル
│   ├── entities/    # エンティティ（Cat, User等）
│   ├── valueObjects/# 値オブジェクト（Emotion, Position等）
│   ├── services/    # ドメインサービス
│   └── repositories/# リポジトリインターフェース
├── application/     # アプリケーションサービス
├── infrastructure/  # インフラストラクチャ層
│   ├── repositories/# リポジトリ実装
│   ├── api/         # ApiClient
│   └── session/     # セッション管理
├── presentation/    # プレゼンテーション層
│   ├── components/  # Reactコンポーネント
│   └── game/        # Phaser Sceneクラス
└── lib/             # 共通ライブラリ
    └── utils/       # ユーティリティ

test/                # テストディレクトリ（srcと同じ構造）
├── domain/
│   ├── entities/
│   └── valueObjects/
└── lib/
```

## プロジェクト固有ルール

### ログ出力

- **禁止**: 直接`console.log()`使用禁止
- **必須**: `@/lib/log.ts`の構造化ログを使用
  - `logError()`, `logWarn()`, `logInfo()`, `logDebug()`
- **特徴**: JSON形式、UUID付き、タイムスタンプ付き、環境変数`LOG_LEVEL`で制御

### API呼び出し

- **禁止**: UI層から直接`fetch()`使用禁止
- **必須**: `@/infrastructure/api/ApiClient.ts`のラッパー関数を使用
- **理由**: エラーハンドリングの共通化、型安全性の確保

### コメント

- **不要なコメント**: 実装の「what」を説明するコメントは削除
- **意味のあるコメント**: 「why」を説明するコメントは許容
- **自己文書化**: 変数名・メソッド名で意図を明確に表現

### セッション管理

- **データ範囲**: ユーザー名とねこの内部状態のみを保存
- **セキュリティ**: iron-sessionで暗号化されたCookieを使用
- **個人情報**: 個人情報は取得せず、一時的なセッション管理のみ

### 状態管理

- **Next.js**: セッションによる状態永続化
- **Phaser**: ステートレス設計（ゲーム開始時に状態を受け取り、終了時に保存）

## 重要な設計ドキュメント

必ず参照すべきドキュメント：

- `@docs/aidlc/inception/ドメインモデル.pu`: 最重要、実装前に必ず確認
- `@docs/adr/ADR-0004_シナリオエンジンのスクラッチ開発.md`: シナリオエンジン設計
- `@docs/product/君はねこを飼えるか/README.md`: プロダクト仕様
- `@docs/product/君はねこを飼えるか/機能一覧.md`: 機能要件
