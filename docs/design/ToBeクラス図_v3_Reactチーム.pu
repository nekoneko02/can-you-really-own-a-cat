@startuml ToBeã‚¯ãƒ©ã‚¹å›³_v3_Reactãƒãƒ¼ãƒ 

title Reactå±¤ã‚¯ãƒ©ã‚¹å›³ï¼ˆMVPï¼‰- Next.js/Reactãƒãƒ¼ãƒ æ‹…å½“

' ===========================
' Next.js/Reactãƒãƒ¼ãƒ ã®æ‹…å½“ç¯„å›²
' ===========================
' - React Layerï¼ˆGameLauncher, ReportPageï¼‰
' - ã‚²ãƒ¼ãƒ å‰å¾Œã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³éƒ¨åˆ†
' - ã‚²ãƒ¼ãƒ èµ·å‹•ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æº–å‚™
' - ã‚²ãƒ¼ãƒ çµæœã®å—ã‘å–ã‚Šã¨è¡¨ç¤º
' ===========================

' ===========================
' React Layer - Webã‚¢ãƒ—ãƒªå±¤
' ===========================

package "React Layer" as PkgReact {
  class GameLauncher {
    + startGame(scenarioId: string): void
    + onGameComplete(result: GameResult): void
  }

  class ReportPage {
    + result: GameResult
    + render(): JSX.Element
  }

  interface GameStartParams {
    scenarioId: string
  }

  interface GameResult {
    scenarioId: string
    completed: boolean
    playerStats: PlayerStats
    finalCatStatus: CatStatus
    eventHistory: EventRecord[]
    report: Report
  }

  interface Report {
    playerBehaviorPattern: string
    feedbackText: string
    emotionLog: EmotionData[]
  }

  interface EventRecord {
    eventId: string
    day: number
    choiceId: string
    emotion: EmotionData
    timestamp: number
  }

  interface EmotionData {
    satisfaction: number
    burden: number
    comment?: string
  }

  interface PlayerStats {
    totalSleepHours: number
    interruptionCount: number
    playCount: number
  }

  interface CatStatus {
    affection: number
    stress: number
    health: number
    hunger: number
  }

  GameLauncher --> GameStartParams : uses
  GameLauncher --> GameResult : receives
  GameLauncher ..> ReportPage : shows
  GameResult --> PlayerStats
  GameResult --> CatStatus
  GameResult --> EventRecord
  GameResult --> Report
  Report --> EmotionData
  EventRecord --> EmotionData
}

note top of PkgReact
  ã€Reactãƒãƒ¼ãƒ ã®å½¹å‰²ï¼ˆMVPç¯„å›²ï¼‰ã€‘
  - ã‚²ãƒ¼ãƒ èµ·å‹•: Phaserã‚’èµ·å‹•ã™ã‚‹ã ã‘
  - ã‚²ãƒ¼ãƒ å¾Œ: çµæœãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º

  ã€å°†æ¥æ‹¡å¼µï¼ˆMVPç¯„å›²å¤–ï¼‰ã€‘
  - ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
  - ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
  - ãƒ—ãƒ¬ã‚¤å¾Œã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ
  - æœ€çµ‚åˆ¤æ–­ç”»é¢
end note

' ===========================
' Phaserãƒãƒ¼ãƒ ã¨ã®å¢ƒç•Œ
' ===========================

package "Phaser Layer (Interface)" as PkgPhaserInterface {
  class BootScene <<External>> {
    + init(data: GameStartParams): void
    + onGameEnd(): void
  }

  note right of BootScene
    ã€Phaserãƒãƒ¼ãƒ æä¾›ã€‘
    - init(): GameStartParamsã‚’å—ã‘å–ã‚‹
    - onGameEnd(): GameResultã‚’Reactã«è¿”ã™
  end note
}

' ===========================
' Domainãƒãƒ¼ãƒ ã¨ã®å¢ƒç•Œ
' ===========================

package "Domain Layer (Interface)" as PkgDomainInterface {
  class Game <<External>> {
    + generateReport(): GameResult
  }

  note right of Game
    ã€Domainãƒãƒ¼ãƒ æä¾›ã€‘
    - generateReport(): GameResultã‚’ç”Ÿæˆ
    - å®Ÿè£…ã¯Domainãƒãƒ¼ãƒ ãŒæ‹…å½“
  end note
}

' ===========================
' ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é–“ã®é–¢ä¿‚æ€§
' ===========================

' React â†’ Phaser (èµ·å‹•æ™‚ã®ã¿)
PkgReact.GameLauncher ..> PkgPhaserInterface.BootScene : launches with GameStartParams

' Phaser â†’ React (çµ‚äº†æ™‚ã®ã¿)
PkgPhaserInterface.BootScene ..> PkgReact.GameLauncher : callback with GameResult

' Domain â†’ React (ãƒ‡ãƒ¼ã‚¿æä¾›)
PkgDomainInterface.Game ..> PkgReact.GameResult : generates

' ===========================
' React Componentã®è©³ç´°è¨­è¨ˆ
' ===========================

package "React Components (è©³ç´°)" as PkgReactComponents {
  class GameLauncherPage {
    - phaserGame: Phaser.Game | null
    + componentDidMount(): void
    + componentWillUnmount(): void
    + startPhaserGame(): void
    + handleGameComplete(result: GameResult): void
    + render(): JSX.Element
  }

  class ReportPage {
    - result: GameResult
    + calculateBehaviorPattern(): string
    + generateFeedbackText(): string
    + renderPlayerStats(): JSX.Element
    + renderCatStatus(): JSX.Element
    + renderEmotionLog(): JSX.Element
    + render(): JSX.Element
  }

  GameLauncherPage --> GameStartParams
  GameLauncherPage --> GameResult
  GameLauncherPage ..> ReportPage : navigates to
  ReportPage --> GameResult
}

note top of PkgReactComponents
  ã€GameLauncherPageã®è²¬å‹™ã€‘
  - Phaserã‚²ãƒ¼ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç”Ÿæˆãƒ»ç ´æ£„
  - GameStartParamsã®æº–å‚™
  - ã‚²ãƒ¼ãƒ å®Œäº†æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å—ã‘å–ã‚Š
  - ReportPageã¸ã®é·ç§»

  ã€ReportPageã®è²¬å‹™ã€‘
  - GameResultã®è§£æãƒ»è¡¨ç¤º
  - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åˆ¤å®š
  - ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ†ã‚­ã‚¹ãƒˆã®ç”Ÿæˆ
  - çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã¨ã®æ¯”è¼ƒè¡¨ç¤º
end note

' ===========================
' ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³
' ===========================

package "Data Flow" {
  note as DataFlowNote
    ã€ã‚²ãƒ¼ãƒ èµ·å‹•æ™‚ã®ãƒ•ãƒ­ãƒ¼ã€‘
    1. GameLauncherPage: startPhaserGame()
    2. GameStartParamsä½œæˆ { scenarioId: "nightcry_01" }
    3. Phaser.Game ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆ
    4. BootScene.init(GameStartParams)

    ã€ã‚²ãƒ¼ãƒ çµ‚äº†æ™‚ã®ãƒ•ãƒ­ãƒ¼ã€‘
    1. BootScene: ã‚²ãƒ¼ãƒ å®Œäº†ã‚’æ¤œçŸ¥
    2. window.onGameComplete(GameResult) å‘¼ã³å‡ºã—
    3. GameLauncherPage: handleGameComplete(GameResult)
    4. Phaser.Game ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç ´æ£„
    5. ReportPage ã¸é·ç§»

    ã€é‡è¦ãªè¨­è¨ˆåŸå‰‡ã€‘
    - ã‚²ãƒ¼ãƒ ä¸­ã¯Reactã¨Phaserã¯ç›´æ¥ã‚„ã‚Šå–ã‚Šã—ãªã„
    - èµ·å‹•æ™‚ãƒ»çµ‚äº†æ™‚ã®ã¿ãƒ‡ãƒ¼ã‚¿å—ã‘æ¸¡ã—
    - PhaserãŒå®Œå…¨ã«ç‹¬ç«‹ã—ã¦å‹•ä½œ
  end note
}

' ===========================
' MVPç¯„å›²ã®ç”»é¢ä¸€è¦§
' ===========================

package "MVP Screens" {
  note as ScreenListNote
    ã€MVPå¿…é ˆç”»é¢ã€‘
    âœ… GameLauncherPage
       - Phaserã‚²ãƒ¼ãƒ ã‚’èµ·å‹•
       - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
       - ã‚²ãƒ¼ãƒ å®Œäº†å¾Œã«ReportPageã¸

    âœ… ReportPage
       - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³è¡¨ç¤º
       - çŒ«ã®æœ€çµ‚çŠ¶æ…‹è¡¨ç¤º
       - æ„Ÿæƒ…ãƒ­ã‚°è¡¨ç¤º
       - çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã¨ã®æ¯”è¼ƒ

    ã€å°†æ¥æ‹¡å¼µï¼ˆMVPç¯„å›²å¤–ï¼‰ã€‘
    ğŸ”µ TopPage
       - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç´¹ä»‹
       - ã‚²ãƒ¼ãƒ ã¸ã®æœŸå¾…å€¤è¨­å®š

    ğŸ”µ OnboardingPage
       - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›
       - é£¼è‚²ã«å¯¾ã™ã‚‹ä¸å®‰èª¿æŸ»

    ğŸ”µ SurveyPage
       - ãƒ—ãƒ¬ã‚¤å¾Œã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ
       - è¡Œå‹•å¤‰å®¹ã®æ¸¬å®š

    ğŸ”µ FinalDecisionPage
       - æœ€çµ‚åˆ¤æ–­ã®ä¿ƒé€²
       - å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã¸ã®èª˜å°
  end note
}

' ===========================
' å‡¡ä¾‹
' ===========================

legend right
  **å‡¡ä¾‹**
  - <<External>>: ä»–ãƒãƒ¼ãƒ æä¾›ã®ã‚¯ãƒ©ã‚¹
  - å®Ÿç·šçŸ¢å° (-->): ä¾å­˜ãƒ»ä¿æŒ
  - ç‚¹ç·šçŸ¢å° (..>): ä½¿ç”¨ãƒ»å‚ç…§

  **Next.js/Reactãƒãƒ¼ãƒ ã®æ‹…å½“ç¯„å›²**
  âœ… React Layerï¼ˆGameLauncher, ReportPageï¼‰
  âœ… TypeScriptå‹å®šç¾©ï¼ˆå…¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰
  âœ… ã‚²ãƒ¼ãƒ å‰å¾Œã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
  âœ… Next.jsãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»ãƒšãƒ¼ã‚¸ç®¡ç†

  **ä¾å­˜æ–¹å‘**
  - React â†’ Phaserï¼ˆèµ·å‹•æ™‚ãƒ»çµ‚äº†æ™‚ã®ã¿ï¼‰
  - React â† Domainï¼ˆGameResultå—ã‘å–ã‚Šï¼‰

  **é‡è¦ãªè¨­è¨ˆåŸå‰‡**
  - ã‚²ãƒ¼ãƒ ä¸­ã¯Reactã¨Phaserã¯ç›´æ¥ã‚„ã‚Šå–ã‚Šã—ãªã„
  - èµ·å‹•æ™‚: GameStartParamsæ¸¡ã—
  - çµ‚äº†æ™‚: GameResultå—ã‘å–ã‚Š
  - Phaserã¯å®Œå…¨ã«ç‹¬ç«‹ã—ã¦å‹•ä½œ
  - MVPç¯„å›²ã¯æœ€å°é™ï¼ˆèµ·å‹•ã¨çµæœè¡¨ç¤ºã®ã¿ï¼‰

  **å°†æ¥æ‹¡å¼µ**
  - TopPage: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç´¹ä»‹
  - OnboardingPage: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¥åŠ›
  - SurveyPage: ãƒ—ãƒ¬ã‚¤å¾Œã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ
  - FinalDecisionPage: æœ€çµ‚åˆ¤æ–­ç”»é¢
end legend

@enduml
